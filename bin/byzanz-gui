#!/bin/bash

readonly DELAY=5
readonly DURATION=10

datetime=$(date +%Y%m%d-%H%M%S)
dir=${HOME}/Pictures
readonly NAME="GIFRecord.${datetime}"

beep () {
	paplay /usr/share/sounds/freedesktop/stereo/bell.oga &
}


dur=$(gdialog \
	--title 'Duration?' \
	--inputbox 'Please enter the screen cast duration in seconds.' 200 100 \
	2>&1)
output=$(gdialog \
	--title 'File name?' \
	--inputbox 'Please enter the file name for output' 200 100 \
	2>&1)

duration=${dur:-${DURATION}}
filename=${output:-${NAME}}.gif

window=$(xwininfo)
read x < <(awk -F: '/Absolute upper-left X/{print $2}' <<< "$window")
read y < <(awk -F: '/Absolute upper-left Y/{print $2}' <<< "$window")
read w < <(awk -F: '/Width/{print $2}' <<< "$window")
read h < <(awk -F: '/Height/{print $2}' <<< "$window")

notify-send "GIFRecord" "Recording duration set to ${dur} seconds. Recording will start in ${DELAY} seconds."

sleep ${DELAY}
beep
byzanz-record -c --verbose --delay=0 --duration=${duration} --x=${x} --y=${y} --width=${w} --height=${h} "${dir}/${filename}"
beep

notify-send "GIFRecord" "Record saved as ${dir}/${filename}"
